<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PORTO REALTIME - Admin Panel</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Moment.js -->
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <style>
        /* =========== LOGIN PAGE STYLES WITH AURORA ANIMATION =========== */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000000;
            min-height: 100vh;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        
        /* Aurora Background Animation */
        @keyframes aurora {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }

        @keyframes aurora-move {
            0% {
                transform: translate(0, 0) rotate(0deg);
                opacity: 0.7;
            }
            25% {
                transform: translate(5%, 5%) rotate(90deg);
                opacity: 0.8;
            }
            50% {
                transform: translate(10%, 0) rotate(180deg);
                opacity: 0.9;
            }
            75% {
                transform: translate(5%, -5%) rotate(270deg);
                opacity: 0.8;
            }
            100% {
                transform: translate(0, 0) rotate(360deg);
                opacity: 0.7;
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            33% {
                transform: translateY(-10px) rotate(120deg);
            }
            66% {
                transform: translateY(10px) rotate(240deg);
            }
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(82, 39, 255, 0.3),
                           0 0 40px rgba(82, 39, 255, 0.2),
                           0 0 60px rgba(82, 39, 255, 0.1);
            }
            50% {
                box-shadow: 0 0 30px rgba(82, 39, 255, 0.5),
                           0 0 60px rgba(82, 39, 255, 0.3),
                           0 0 90px rgba(82, 39, 255, 0.2);
            }
        }
        
        /* Login Styles */
        #loginPage {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background: linear-gradient(-45deg, 
                #0a0a14, 
                #0f0f1f, 
                #1a1a2e, 
                #16213e, 
                #0f3460
            );
            background-size: 400% 400%;
            animation: aurora 15s ease infinite;
        }
        
        /* Aurora Layers */
        #loginPage::before,
        #loginPage::after {
            content: '';
            position: absolute;
            width: 150%;
            height: 150%;
            top: -25%;
            left: -25%;
            opacity: 0.3;
            pointer-events: none;
            z-index: 0;
        }
        
        #loginPage::before {
            background: radial-gradient(
                circle at 30% 30%,
                rgba(82, 39, 255, 0.4) 0%,
                transparent 50%
            );
            animation: aurora-move 20s linear infinite;
        }
        
        #loginPage::after {
            background: radial-gradient(
                circle at 70% 70%,
                rgba(255, 159, 252, 0.3) 0%,
                transparent 50%
            );
            animation: aurora-move 25s linear infinite reverse;
        }
        
        /* Aurora Particles */
        .aurora-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            pointer-events: none;
            z-index: 0;
        }
        
        .aurora-particle:nth-child(odd) {
            background: rgba(82, 39, 255, 0.6);
        }
        
        .aurora-particle:nth-child(even) {
            background: rgba(255, 159, 252, 0.6);
        }
        
        /* Floating Shapes */
        .floating-shape {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            filter: blur(20px);
            opacity: 0.4;
            z-index: 0;
        }
        
        .floating-shape.shape1 {
            width: 300px;
            height: 300px;
            top: 10%;
            left: 10%;
            animation: float 25s ease-in-out infinite;
        }
        
        .floating-shape.shape2 {
            width: 200px;
            height: 200px;
            bottom: 20%;
            right: 15%;
            animation: float 30s ease-in-out infinite reverse;
        }
        
        .floating-shape.shape3 {
            width: 150px;
            height: 150px;
            top: 50%;
            left: 80%;
            animation: float 20s ease-in-out infinite;
        }
        
        .login-box {
            position: relative;
            z-index: 2;
            background: rgba(10, 10, 20, 0.85);
            backdrop-filter: blur(15px);
            padding: 60px 50px;
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 75px rgba(0, 0, 0, 0.7),
                       inset 0 1px 0 rgba(255, 255, 255, 0.1);
            width: 480px;
            max-width: 90%;
            animation: slideUp 0.8s ease-out;
            color: white;
            overflow: hidden;
        }
        
        .login-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(82, 39, 255, 0.5), 
                rgba(255, 159, 252, 0.5), 
                transparent
            );
            z-index: 1;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(80px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .logo {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .logo-icon {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, #5227FF 0%, #FF9FFC 100%);
            border-radius: 50%;
            margin: 0 auto 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 42px;
            animation: pulse-glow 4s infinite;
            position: relative;
            overflow: hidden;
        }
        
        .logo-icon::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                transparent 30%, 
                rgba(255, 255, 255, 0.2) 50%, 
                transparent 70%
            );
            animation: shine 3s infinite linear;
        }
        
        @keyframes shine {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }
        
        .login-box h1 {
            text-align: center;
            margin-bottom: 15px;
            color: white;
            font-size: 36px;
            background: linear-gradient(90deg, #FF9FFC, #5227FF);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            letter-spacing: 1px;
        }
        
        .subtitle {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            margin-bottom: 40px;
            letter-spacing: 1px;
        }
        
        .input-group {
            margin-bottom: 35px;
            position: relative;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 12px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            font-size: 16px;
            letter-spacing: 1px;
        }
        
        .input-group input {
            width: 100%;
            padding: 18px 55px 18px 20px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            font-size: 16px;
            transition: all 0.4s;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-weight: 500;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #5227FF;
            box-shadow: 0 0 0 4px rgba(82, 39, 255, 0.3),
                       inset 0 2px 10px rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        .input-icon {
            position: absolute;
            right: 20px;
            top: 52px;
            color: #FF9FFC;
            font-size: 22px;
            transition: all 0.3s;
        }
        
        .input-group input:focus + .input-icon {
            color: #5227FF;
            transform: scale(1.2);
        }
        
        .btn-login {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #5227FF, #B19EEF, #FF9FFC);
            background-size: 200% 200%;
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
            letter-spacing: 2px;
            animation: gradientShift 4s ease infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .btn-login:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(82, 39, 255, 0.6);
        }
        
        .btn-login:active {
            transform: translateY(-2px);
        }
        
        .btn-login::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }
        
        .btn-login:hover::after {
            left: 100%;
        }
        
        .alert {
            padding: 16px 20px;
            margin-bottom: 30px;
            border-radius: 12px;
            font-size: 15px;
            animation: slideDown 0.4s ease-out;
            backdrop-filter: blur(10px);
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .alert-error {
            background: rgba(255, 87, 87, 0.2);
            color: #ff5757;
            border-left: 5px solid #ff5757;
        }
        
        .alert-success {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border-left: 5px solid #00ff88;
        }
        
        .hidden {
            display: none !important;
        }
        
        .floating-text {
            position: absolute;
            bottom: 30px;
            left: 0;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 14px;
            letter-spacing: 2px;
            z-index: 2;
            animation: fadeInOut 8s ease-in-out infinite;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* =========== PORTFOLIO PAGE STYLES =========== */
        /* VARIABEL CSS UNTUK DARK MODE (DEFAULT) */
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #2a2b36;
            --accent: #ffd700;
            --success: #4ecdc4;
            --danger: #ff6b6b;
            --warning: #ffa94d;
            --dark: #1e1f29;
            --light: #f8f9fa;
            --card-bg: #2a2b36;
            --card-border: #3a3b46;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0b0;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --border-radius: 16px;
            --transition: all 0.3s ease;
        }
        
        /* VARIABEL CSS UNTUK LIGHT MODE */
        body.light-theme {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #f5f7fa;
            --accent: #ffd700;
            --success: #2a9d8f;
            --danger: #e53935;
            --warning: #ff9800;
            --dark: #f5f7fa;
            --light: #2a2b36;
            --card-bg: #ffffff;
            --card-border: #e0e0e0;
            --text-primary: #2a2b36;
            --text-secondary: #666;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        /* BACKGROUND UTAMA PORTFOLIO */
        #portfolioPage {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--secondary), var(--dark));
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            transition: var(--transition);
            overflow-y: auto;
            position: relative;
        }
        
        /* DARK MODE BACKGROUND (DEFAULT) */
        #portfolioPage {
            background: linear-gradient(135deg, #1a1c28, #2a2b36);
        }
        
        /* LIGHT MODE BACKGROUND */
        body.light-theme #portfolioPage {
            background: linear-gradient(135deg, #e4edf5, #f5f7fa);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(30, 31, 41, 0.7);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px;
            border: 1px solid rgba(58, 59, 70, 0.5);
            transition: var(--transition);
            overflow: visible;
        }
        
        /* LIGHT MODE CONTAINER */
        body.light-theme .container {
            background: rgba(245, 247, 250, 0.9);
            border: 1px solid rgba(224, 224, 224, 0.5);
        }
        
        /* Header Styles */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--card-border);
            margin-bottom: 30px;
            transition: border-color 0.3s;
        }
        
        .app-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .app-title h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .app-logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        /* Username dengan Verified Badge */
        .username-container {
            display: flex;
            align-items: center;
            color: var(--text-secondary);
            font-weight: 500;
            background: rgba(58, 59, 70, 0.3);
            padding: 8px 15px;
            border-radius: 10px;
            transition: var(--transition);
        }
        
        body.light-theme .username-container {
            background: rgba(224, 224, 224, 0.3);
        }
        
        .username-with-badge {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .verified-badge {
            display: inline-flex;
            align-items: center;
        }
        
        .verified-badge img {
            width: 16px;
            height: 16px;
            object-fit: contain;
            vertical-align: middle;
        }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            margin-bottom: 25px;
            background: var(--card-bg);
            border-radius: 50px;
            padding: 5px;
            transition: var(--transition);
        }
        
        .tab {
            flex: 1;
            padding: 15px 25px;
            text-align: center;
            cursor: pointer;
            border-radius: 50px;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            overflow: visible;
        }
        
        /* Theme Toggle Button */
        .theme-toggle {
            background: linear-gradient(135deg, var(--card-bg), var(--dark));
            border: 1px solid var(--card-border);
            border-radius: 50px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-primary);
        }
        
        .theme-toggle:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* Price Display */
        .price-display-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .price-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            border: 1px solid var(--card-border);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: var(--transition);
        }
        
        .price-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .price-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .price-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .currency-selector, .coin-selector {
            flex: 1;
            position: relative;
        }
        
        .currency-selector select, .coin-selector select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid var(--card-border);
            background: var(--card-bg);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            transition: var(--transition);
            appearance: none;
        }
        
        .currency-selector::after, .coin-selector::after {
            content: '\f078';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: var(--text-secondary);
        }
        
        .coin-price-display {
            flex: 2;
            display: flex;
            align-items: center;
            background: rgba(58, 59, 70, 0.3);
            padding: 15px;
            border-radius: 10px;
            transition: var(--transition);
            flex-wrap: wrap;
            gap: 10px;
        }
        
        /* LIGHT MODE COIN PRICE DISPLAY */
        body.light-theme .coin-price-display {
            background: rgba(224, 224, 224, 0.3);
        }
        
        .price-label {
            font-weight: 600;
            margin-right: 10px;
            color: var(--text-secondary);
        }
        
        .price-value {
            font-weight: bold;
            font-size: 22px;
            font-family: 'Roboto', sans-serif;
            flex: 1;
            color: var(--text-primary);
        }
        
        .price-indicator {
            font-size: 24px;
            font-weight: bold;
            min-width: 30px;
            text-align: center;
        }
        
        .api-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .api-status.live {
            background: rgba(78, 205, 196, 0.2);
            color: var(--success);
        }
        
        .api-status.fallback {
            background: rgba(255, 169, 77, 0.2);
            color: var(--warning);
        }
        
        .api-status.error {
            background: rgba(255, 107, 107, 0.2);
            color: var(--danger);
        }
        
        .hour-change {
            font-size: 16px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 5px;
            margin-left: 5px;
        }
        
        .positive {
            color: var(--success);
            background: rgba(78, 205, 196, 0.15);
        }
        
        .negative {
            color: var(--danger);
            background: rgba(255, 107, 107, 0.15);
        }
        
        /* Form Styles */
        .form-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            border: 1px solid var(--card-border);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            transition: var(--transition);
        }
        
        .form-section h3 {
            margin-bottom: 20px;
            font-size: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid var(--card-border);
            background: var(--card-bg);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #e53935);
        }
        
        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        /* Table Styles */
        .table-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            border: 1px solid var(--card-border);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow: auto;
            transition: var(--transition);
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .table-header h2 {
            font-size: 22px;
            color: var(--text-primary);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            border-radius: var(--border-radius);
            min-width: 1200px;
        }
        
        th, td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid var(--card-border);
        }
        
        th {
            background: rgba(58, 59, 70, 0.3);
            color: var(--text-secondary);
            font-weight: 600;
            transition: var(--transition);
        }
        
        /* LIGHT MODE TABLE HEADER */
        body.light-theme th {
            background: rgba(224, 224, 224, 0.3);
        }
        
        tbody tr:hover {
            background: rgba(67, 97, 238, 0.05);
        }
        
        tfoot tr {
            background: rgba(58, 59, 70, 0.5);
            font-weight: bold;
        }
        
        /* LIGHT MODE TABLE FOOTER */
        body.light-theme tfoot tr {
            background: rgba(224, 224, 224, 0.5);
        }
        
        .coin-logo {
            width: 30px;
            height: 30px;
            vertical-align: middle;
            margin-right: 10px;
            border-radius: 50%;
        }
        
        /* Dashboard Styles */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .dashboard-header h1 {
            font-size: 28px;
            color: var(--text-primary);
        }
        
        .dashboard-price-display {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        /* Coin Selector */
        .coin-selector-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .coin-chip {
            padding: 10px 20px;
            background: var(--card-bg);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid var(--card-border);
            color: var(--text-primary);
        }
        
        .coin-chip.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
        }
        
        .coin-chip img {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }
        
        /* Cards Container */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            border: 1px solid var(--card-border);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--success));
        }
        
        .card h3 {
            margin-bottom: 15px;
            font-size: 18px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
            font-family: 'Roboto', sans-serif;
            letter-spacing: -1px;
            color: var(--text-primary);
        }
        
        .card-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 10px;
        }
        
        /* Chart Container */
        .chart-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            border: 1px solid var(--card-border);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            height: 420px;
            position: relative;
            transition: var(--transition);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            z-index: 10;
        }
        
        .chart-header h2 {
            font-size: 22px;
            color: var(--text-primary);
        }
        
        .chart-actions {
            display: flex;
            gap: 10px;
        }
        
        .chart-btn {
            padding: 8px 15px;
            background: rgba(58, 59, 70, 0.3);
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .chart-btn.active {
            background: var(--primary);
            color: white;
        }
        
        /* LIGHT MODE CHART BUTTON */
        body.light-theme .chart-btn {
            background: rgba(224, 224, 224, 0.3);
        }
        
        .chart-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: var(--text-secondary);
        }
        
        /* Footer dengan Verified Badge */
        .footer-username {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .footer-username img {
            width: 14px;
            height: 14px;
            vertical-align: middle;
        }
        
        .app-footer {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 14px;
            border-top: 1px solid var(--card-border);
            margin-top: 30px;
        }
        
        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary);
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            color: var(--text-secondary);
        }

        /* Logout Button */
        .btn-logout {
            background: linear-gradient(135deg, #ff6b6b, #e53935);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-logout:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        /* =========== ADMIN PANEL STYLES =========== */
        .admin-badge {
            background: linear-gradient(135deg, #ffd700, #ff9800);
            color: #000;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 5px;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #ff9800);
        }

        .btn-warning:hover {
            box-shadow: 0 5px 15px rgba(255, 169, 77, 0.3);
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: rgba(78, 205, 196, 0.2);
            color: var(--success);
        }

        .status-suspended {
            background: rgba(255, 107, 107, 0.2);
            color: var(--danger);
        }

        .role-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .role-admin {
            background: rgba(67, 97, 238, 0.2);
            color: var(--primary);
        }

        .role-player {
            background: rgba(255, 169, 77, 0.2);
            color: var(--warning);
        }

        .role-moderator {
            background: rgba(78, 205, 196, 0.2);
            color: var(--success);
        }

        .activity-log {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .log-entry {
            padding: 10px 15px;
            border-bottom: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-time {
            font-size: 12px;
            color: var(--text-secondary);
            min-width: 150px;
        }

        .log-user {
            font-weight: 600;
            min-width: 120px;
        }

        .log-action {
            flex: 1;
        }

        .log-details {
            font-size: 12px;
            color: var(--text-secondary);
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .player-activity {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .player-status.online {
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
        }

        .player-status.offline {
            background: var(--text-secondary);
        }

        .player-status.away {
            background: var(--warning);
            box-shadow: 0 0 10px var(--warning);
        }

        /* =========== RESPONSIVE DESIGN =========== */
        
        /* Untuk Desktop (default) */
        .mobile-only {
            display: none !important;
        }
        
        .desktop-only {
            display: block !important;
        }
        
        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            width: 50px;
            height: 50px;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            color: var(--text-primary);
        }
        
        /* Mobile Menu */
        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(30, 31, 41, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        
        .mobile-menu.active {
            display: flex;
        }
        
        .mobile-menu .tab {
            width: 80%;
            max-width: 300px;
            padding: 20px;
            font-size: 18px;
        }
        
        .mobile-menu-close {
            position: absolute;
            top: 30px;
            right: 30px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            color: var(--text-primary);
        }
        
        /* Responsive Breakpoints */
        @media (max-width: 1200px) {
            .container {
                padding: 20px;
            }
            
            .cards-container {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            table {
                min-width: 1000px;
            }
        }
        
        @media (max-width: 992px) {
            .app-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .header-actions {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .dashboard-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .dashboard-price-display {
                width: 100%;
                justify-content: center;
            }
            
            .price-content {
                flex-direction: column;
            }
            
            .coin-price-display {
                width: 100%;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .form-group {
                min-width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            /* Tampilan Handphone */
            .mobile-only {
                display: block !important;
            }
            
            .desktop-only {
                display: none !important;
            }
            
            /* Login page adjustments for mobile */
            .login-box {
                padding: 40px 25px;
                margin: 20px;
            }
            
            .logo-icon {
                width: 70px;
                height: 70px;
                font-size: 32px;
            }
            
            .login-box h1 {
                font-size: 28px;
            }
            
            .btn-login {
                padding: 18px;
                font-size: 16px;
            }
            
            .floating-shape {
                display: none;
            }
            
            /* Portfolio page adjustments for mobile */
            #portfolioPage {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
                border-radius: 12px;
            }
            
            .app-title h1 {
                font-size: 22px;
            }
            
            .app-logo {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
            
            .tabs.desktop-only {
                display: none;
            }
            
            .mobile-menu-toggle {
                display: flex;
            }
            
            .username-container {
                padding: 6px 12px;
                font-size: 14px;
            }
            
            .theme-toggle, .btn-logout {
                width: 45px;
                height: 45px;
                padding: 0;
                justify-content: center;
            }
            
            .btn-logout span {
                display: none;
            }
            
            .price-card {
                padding: 15px;
            }
            
            .price-header h3 {
                font-size: 16px;
            }
            
            .price-value {
                font-size: 18px;
            }
            
            .form-section {
                padding: 20px;
            }
            
            .form-section h3 {
                font-size: 18px;
            }
            
            .table-container {
                padding: 15px;
            }
            
            .table-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .cards-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .card {
                padding: 20px;
            }
            
            .card-value {
                font-size: 28px;
            }
            
            .chart-container {
                height: 350px;
                padding: 20px;
            }
            
            .chart-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .chart-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .chart-btn {
                flex: 1;
                text-align: center;
            }
            
            .coin-chip {
                padding: 8px 15px;
                font-size: 14px;
            }
            
            .coin-chip img {
                width: 20px;
                height: 20px;
            }
            
            /* Mobile table view */
            .mobile-transaction-item {
                background: var(--card-bg);
                border: 1px solid var(--card-border);
                border-radius: var(--border-radius);
                padding: 15px;
                margin-bottom: 10px;
            }
            
            .mobile-transaction-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 10px;
            }
            
            .mobile-transaction-coin {
                display: flex;
                align-items: center;
                gap: 10px;
                font-weight: bold;
                font-size: 16px;
            }
            
            .mobile-transaction-details {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                font-size: 14px;
            }
            
            .mobile-detail-item {
                display: flex;
                flex-direction: column;
            }
            
            .mobile-detail-label {
                color: var(--text-secondary);
                font-size: 12px;
                margin-bottom: 3px;
            }
            
            .mobile-detail-value {
                font-weight: 600;
            }
        }
        
        @media (max-width: 480px) {
            /* Small mobile adjustments */
            .login-box {
                padding: 30px 20px;
            }
            
            .login-box h1 {
                font-size: 24px;
            }
            
            .subtitle {
                font-size: 14px;
            }
            
            .input-group input {
                padding: 15px 45px 15px 15px;
                font-size: 14px;
            }
            
            .input-icon {
                font-size: 18px;
                top: 48px;
            }
            
            .app-title h1 {
                font-size: 20px;
            }
            
            .mobile-transaction-details {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 300px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }
        
        /* Landscape orientation for mobile */
        @media (max-height: 600px) and (orientation: landscape) {
            #loginPage {
                padding: 20px 0;
            }
            
            .login-box {
                padding: 30px 40px;
                margin: 10px;
            }
            
            .logo-icon {
                width: 60px;
                height: 60px;
                font-size: 28px;
                margin-bottom: 15px;
            }
            
            .input-group {
                margin-bottom: 20px;
            }
            
            .btn-login {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage">
        <!-- Hapus canvas galaxy -->
        <!-- Tambahkan floating shapes untuk efek aurora -->
        <div class="floating-shape shape1"></div>
        <div class="floating-shape shape2"></div>
        <div class="floating-shape shape3"></div>
        
        <div class="login-box">
            <div class="logo">
                <div class="logo-icon"></div>
            </div>
            <h1>CRYPTO PORTO</h1>
            <p class="subtitle">Secure Access to Your Portfolio</p>
            
            <div id="alertContainer"></div>
            
            <div class="input-group">
                <label>USERNAME</label>
                <input type="text" id="username" placeholder="Enter your username">
                <span class="input-icon"></span>
            </div>
            
            <div class="input-group">
                <label>PASSWORD</label>
                <input type="password" id="key" placeholder="Enter your secret key">
                <span class="input-icon"></span>
            </div>
            
            <button class="btn-login" id="loginBtn">ACCESS PORTFOLIO</button>
        </div>
        
        <div class="floating-text">
            PORTO SECURITY SYSTEM  REAL-TIME ENCRYPTION
        </div>
    </div>

    <!-- Portfolio Page (akan ditampilkan setelah login) -->
    <div id="portfolioPage" class="hidden">
        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-menu-close" id="mobileMenuClose">
                <i class="fas fa-times"></i>
            </div>
            <div class="tab active" data-tab="transactions">
                <i class="fas fa-exchange-alt"></i> Transactions
            </div>
            <div class="tab" data-tab="dashboard">
                <i class="fas fa-chart-line"></i> Dashboard
            </div>
            <div class="tab" data-tab="admin" id="mobileAdminTab" style="display: none;">
                <i class="fas fa-user-shield"></i> Admin
            </div>
            <div class="tab" id="mobileLogoutBtn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </div>
        </div>
        
        <div class="container">
            <header class="app-header">
                <div class="app-title">
                    <div class="app-logo">
                        <i class="fas fa-coins"></i>
                    </div>
                    <h1>PORTO REALTIME</h1>
                </div>
                <div class="header-actions">
                    <div id="currentUsername" class="username-container">
                        <!-- Username akan dimasukkan di sini -->
                    </div>
                    <button class="theme-toggle" id="theme-toggle" title="Toggle theme">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="btn-logout desktop-only" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
                    </button>
                    <button class="mobile-menu-toggle mobile-only" id="mobileMenuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </header>
            
            <!-- Desktop Tabs -->
            <div class="tabs desktop-only">
                <div class="tab active" data-tab="transactions">
                    <i class="fas fa-exchange-alt"></i> Transactions
                </div>
                <div class="tab" data-tab="dashboard">
                    <i class="fas fa-chart-line"></i> Dashboard
                </div>
                <div class="tab" data-tab="admin" id="adminTab" style="display: none;">
                    <i class="fas fa-user-shield"></i> Admin Panel
                    <span class="admin-badge">ADMIN</span>
                </div>
            </div>
            
            <!-- Mobile Current Tab Indicator -->
            <div class="mobile-only" style="margin-bottom: 20px; text-align: center;">
                <h2 id="currentMobileTab">Transactions</h2>
            </div>
            
            <!-- Transactions Tab -->
            <div id="transactions" class="tab-content active">
                <div class="price-display-container">
                    <div class="price-card">
                        <div class="price-header">
                            <h3><i class="fas fa-chart-line"></i> Coin Price Tracker</h3>
                        </div>
                        <div class="price-content">
                            <div class="currency-selector">
                                <select id="currencySelector">
                                    <option value="IDR">IDR (Rp)</option>
                                    <option value="USD">USD ($)</option>
                                    <option value="EUR">EUR ()</option>
                                    <option value="GBP">GBP ()</option>
                                    <option value="JPY">JPY ()</option>
                                    <option value="AUD">AUD (A$)</option>
                                    <option value="CAD">CAD (C$)</option>
                                    <option value="CHF">CHF (CHF)</option>
                                    <option value="SEK">SEK (kr)</option>
                                    <option value="NOK">NOK (kr)</option>
                                </select>
                            </div>
                            <div class="coin-selector">
                                <select id="priceCoinSelector">
                                    <option value="">Loading coins...</option>
                                </select>
                            </div>
                            <div class="coin-price-display">
                                <span class="price-label">Current Price:</span>
                                <span id="priceDisplay" class="price-value">Select a coin</span>
                                <span id="priceIndicator" class="price-indicator"></span>
                                <span id="hourChange" class="hour-change"></span>
                                <span id="apiStatus" class="api-status"></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3><i class="fas fa-plus-circle"></i> Add Single Transaction</h3>
                    <form id="transactionForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="date">Date</label>
                                <input type="date" id="date" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="coin">Coin</label>
                                <select id="coin" class="form-control" required>
                                    <option value="">Loading coins...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="type">Type</label>
                                <select id="type" class="form-control">
                                    <option value="buy">Buy</option>
                                    <option value="sell">Sell</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="price">Price (IDR)</label>
                                <input type="number" id="price" class="form-control" step="0.01" placeholder="Price per coin" required>
                            </div>
                            <div class="form-group">
                                <label for="modalBeli">Investment (IDR)</label>
                                <input type="number" id="modalBeli" class="form-control" step="0.01" placeholder="Total investment" required>
                            </div>
                            <div class="form-group" style="align-self: flex-end;">
                                <button type="submit" class="btn">
                                    <i class="fas fa-plus"></i> Add Transaction
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="form-section">
                    <h3><i class="fas fa-file-import"></i> Batch Transactions</h3>
                    <form id="batchTransactionForm">
                        <div class="form-group">
                            <label for="batchInput">Enter transactions in CSV format (DATE,COIN,TYPE,HARGA BELI,MODAL BELI)</label>
                            <textarea id="batchInput" class="form-control" rows="5" placeholder="Example: 2025-07-07,BTC,buy,1762332734,1000000"></textarea>
                        </div>
                        <div id="batchError" style="color: var(--danger); margin: 15px 0;"></div>
                        <div>
                            <button type="submit" class="btn">
                                <i class="fas fa-upload"></i> Add Batch Transactions
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="table-container desktop-only">
                    <div class="table-header">
                        <h2><i class="fas fa-table"></i> Transaction History</h2>
                        <button id="clearTransactions" class="btn btn-danger">
                            <i class="fas fa-trash-alt"></i> Clear All
                        </button>
                    </div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>DATE</th>
                                    <th>LOGO</th>
                                    <th>Coin Name</th>
                                    <th>Code</th>
                                    <th>Investment</th>
                                    <th>Buy Price</th>
                                    <th>Quantity</th>
                                    <th>Current Value</th>
                                    <th>Profit %</th>
                                    <th>P&L</th>
                                </tr>
                            </thead>
                            <tbody id="transactionTable">
                                <!-- Transactions will be added here dynamically -->
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="7">TOTAL PORTFOLIO</td>
                                    <td id="totalValue">Rp0.00</td>
                                    <td></td>
                                    <td id="totalPNLValue">Rp0.00</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                
                <!-- Mobile Transaction List -->
                <div class="mobile-transaction-list mobile-only" id="mobileTransactionList">
                    <!-- Transactions will be added here dynamically -->
                </div>
                
                <div class="mobile-only" style="text-align: center; margin: 20px 0;">
                    <button id="clearTransactionsMobile" class="btn btn-danger">
                        <i class="fas fa-trash-alt"></i> Clear All Transactions
                    </button>
                </div>
                
                <div class="form-section">
                    <div class="warning">
                        <i class="fas fa-exclamation-circle"></i> Note: Realtime price updates are fetched from multiple cryptocurrency APIs. If one fails, the system automatically switches to another source.
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content">
                <div class="dashboard-header">
                    <h1><i class="fas fa-chart-pie"></i> Portfolio Dashboard</h1>
                    <div class="dashboard-price-display">
                        <span id="dashboardPriceValue">Loading portfolio value...</span>
                        <span id="dashboardPriceIndicator" class="price-indicator"></span>
                    </div>
                </div>
                
                <div class="coin-selector-chips" id="coinSelector">
                    <!-- Coin chips will be added here dynamically -->
                </div>
                
                <div class="cards-container">
                    <div class="card">
                        <h3><i class="fas fa-wallet"></i> Total Investment</h3>
                        <div id="totalInvestment" class="card-value">Rp0</div>
                        <p class="card-description">Total amount invested in crypto</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-chart-bar"></i> Current Value</h3>
                        <div id="currentValue" class="card-value">Rp0</div>
                        <p class="card-description">Current value of your portfolio</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-money-bill-wave"></i> Profit/Loss</h3>
                        <div id="profitLoss" class="card-value">Rp0</div>
                        <p class="card-description">Total unrealized P&L</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-trophy"></i> Best Performer</h3>
                        <div id="bestPerformer" class="card-value">-</div>
                        <p class="card-description">Coin with highest returns</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-percentage"></i> Profit Percentage</h3>
                        <div id="profitPercentage" class="card-value">0%</div>
                        <p class="card-description">Percentage gain/loss from initial investment</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-calculator"></i> Average Price</h3>
                        <div id="averagePrice" class="card-value">-</div>
                        <p class="card-description">Average buy price per unit</p>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-header">
                        <h2><i class="fas fa-chart-line"></i> Portfolio Performance</h2>
                        <div class="chart-actions">
                            <button id="showValueChart" class="chart-btn active">Value</button>
                            <button id="showInvestmentChart" class="chart-btn">Investment</button>
                            <button id="showHoldingsChart" class="chart-btn">Holdings</button>
                        </div>
                    </div>
                    <canvas id="performanceChart"></canvas>
                    <div id="chartPlaceholder" class="chart-placeholder">
                        <h3>No data available</h3>
                        <p>Add transactions to see performance chart</p>
                    </div>
                </div>
                
                <div class="table-container desktop-only">
                    <div class="table-header">
                        <h2><i class="fas fa-history"></i> Recent Transactions</h2>
                    </div>
                    <div style="overflow-x: auto;">
                        <table id="recentTransactions">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Coin</th>
                                    <th>Type</th>
                                    <th>Price</th>
                                    <th>Amount</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Transactions will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Admin Panel Tab -->
            <div id="admin" class="tab-content">
                <div class="dashboard-header">
                    <h1><i class="fas fa-user-shield"></i> Admin Panel</h1>
                    <div class="dashboard-price-display">
                        <span id="firebaseStatus">Firebase: Connected</span>
                        <span class="price-indicator positive"></span>
                    </div>
                </div>

                <div class="cards-container">
                    <div class="card">
                        <h3><i class="fas fa-users"></i> Total Users</h3>
                        <div id="totalUsers" class="card-value">0</div>
                        <p class="card-description">Registered users in system</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-user-check"></i> Active Users</h3>
                        <div id="activeUsers" class="card-value">0</div>
                        <p class="card-description">Users online now</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-user-slash"></i> Suspended</h3>
                        <div id="suspendedUsers" class="card-value">0</div>
                        <p class="card-description">Suspended accounts</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-chart-line"></i> Active Players</h3>
                        <div id="activePlayers" class="card-value">0</div>
                        <p class="card-description">Active in last 24h</p>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-user-plus"></i> Add New User</h3>
                    <form id="addUserForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newUsername">Username</label>
                                <input type="text" id="newUsername" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="newPassword">Password</label>
                                <input type="password" id="newPassword" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="newRole">Role</label>
                                <select id="newRole" class="form-control" required>
                                    <option value="player">Player</option>
                                    <option value="admin">Admin</option>
                                    <option value="moderator">Moderator</option>
                                </select>
                            </div>
                            <div class="form-group" style="align-self: flex-end;">
                                <button type="submit" class="btn">
                                    <i class="fas fa-plus"></i> Add User
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h2><i class="fas fa-users-cog"></i> User Management</h2>
                        <div class="header-actions">
                            <button id="refreshUsers" class="btn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table id="userTable">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Last Login</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                                <tr><td colspan="5" style="text-align: center;">Loading users...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-history"></i> Activity Log (Last 50 Events)</h3>
                    <div class="activity-log" id="activityLog">
                        <div class="log-entry">
                            <div class="log-time">Loading...</div>
                            <div class="log-user">System</div>
                            <div class="log-action">Initializing activity log</div>
                            <div class="log-details">Please wait</div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-chart-bar"></i> Real-time Stats</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Online Players</label>
                            <div class="player-activity" id="onlinePlayers">
                                <div class="player-status online"></div>
                                <span>Loading...</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>System Status</label>
                            <div id="systemStatus" class="status-badge status-active">Operational</div>
                        </div>
                        <div class="form-group">
                            <label>Database</label>
                            <div id="databaseStatus" class="status-badge status-active">Connected</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <footer class="app-footer">
                <p> 2025 Real-time PORTO Powered by Stev | Logged in as: <span id="footerUsername" class="footer-username">Guest</span></p>
            </footer>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCPKHpgOb5v11rbGm2GLlqVFI2o0C0ceoI",
            authDomain: "portonew.firebaseapp.com",
            databaseURL: "https://portonew-default-rtdb.firebaseio.com/",
            projectId: "portonew",
            storageBucket: "portonew.firebasestorage.app",
            messagingSenderId: "320808752335",
            appId: "1:320808752335:web:b8dd12e2548d464bc793ba"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const validAccounts = {
            'DAVIDHALIM': 'DAVIDHALIM',
            'Tester1': 'Tester1',
            'Cher': 'Cher',            
            'DeveloperXStev': 'Stev',
            'Admin': 'Admin123'  
        };

        let currentUser = null;
        let isAdmin = false;
        let firebaseConnected = false;

        // Initialize aurora particles
        window.addEventListener('DOMContentLoaded', function() {
            // Tambahkan partikel aurora
            createAuroraParticles();
            
            const savedUser = sessionStorage.getItem('loggedInUser');
            if (savedUser) {
                currentUser = savedUser;
                isAdmin = checkIfAdmin(currentUser);
                showPortfolio();
                initFirebaseConnection();
            }
        });

        // Check if user is admin
        function checkIfAdmin(username) {
            const adminUsers = ['DeveloperXStev', 'Admin'];
            return adminUsers.includes(username);
        }

        // Initialize Firebase connection
        function initFirebaseConnection() {
            const connectedRef = database.ref(".info/connected");
            connectedRef.on("value", function(snap) {
                firebaseConnected = snap.val() === true;
                const statusElement = document.getElementById('firebaseStatus');
                if (statusElement) {
                    statusElement.textContent = firebaseConnected ? "Firebase: Connected" : "Firebase: Disconnected";
                    statusElement.style.color = firebaseConnected ? "var(--success)" : "var(--danger)";
                }
                
                if (firebaseConnected && currentUser) {
                    // Record user login in Firebase
                    recordActivity(currentUser, 'login', 'User logged into system');
                    updateUserStatus(currentUser, true);
                    
                    if (isAdmin) {
                        loadAdminData();
                    }
                }
            });
        }

        // Record activity to Firebase
        function recordActivity(username, action, details) {
            if (!firebaseConnected) return;
            
            const timestamp = new Date().toISOString();
            const activityRef = database.ref('activities').push();
            activityRef.set({
                username: username,
                action: action,
                details: details,
                timestamp: timestamp,
                ip: 'N/A' // Dalam implementasi nyata, dapatkan IP user
            });
        }

        // Update user status in Firebase
        function updateUserStatus(username, isOnline) {
            if (!firebaseConnected) return;
            
            const userRef = database.ref('users/' + username);
            userRef.update({
                lastLogin: new Date().toISOString(),
                isOnline: isOnline,
                lastSeen: new Date().toISOString()
            });
        }

        // Fungsi untuk membuat partikel aurora
        function createAuroraParticles() {
            const loginPage = document.getElementById('loginPage');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'aurora-particle';
                
                // Random position
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                
                // Random size
                const size = Math.random() * 4 + 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                // Random animation
                const duration = Math.random() * 20 + 10;
                const delay = Math.random() * 5;
                particle.style.animation = `float ${duration}s ease-in-out ${delay}s infinite`;
                
                // Random opacity
                particle.style.opacity = Math.random() * 0.5 + 0.3;
                
                loginPage.appendChild(particle);
            }
        }

        // Show alert function
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            container.innerHTML = '<div class="alert alert-' + type + '">' + message + '</div>';
            
            // Add floating animation
            const alert = container.querySelector('.alert');
            setTimeout(() => {
                alert.style.transform = 'translateY(-10px)';
                alert.style.opacity = '0.9';
            }, 50);
            
            setTimeout(function() {
                container.innerHTML = '';
            }, 4000);
        }

        // Handle login
        function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const key = document.getElementById('key').value.trim();

            if (!username || !key) {
                showAlert('Please enter both username and key!', 'error');
                return;
            }

            // Validasi login
            if (validAccounts[username] && validAccounts[username] === key) {
                currentUser = username;
                isAdmin = checkIfAdmin(username);
                sessionStorage.setItem('loggedInUser', username);
                
                // Add success effects
                const loginBtn = document.getElementById('loginBtn');
                loginBtn.style.background = 'linear-gradient(135deg, #00ff88, #00ccff)';
                loginBtn.textContent = ' ACCESS GRANTED';
                
                showAlert('Authentication successful! Redirecting...', 'success');
                
                setTimeout(() => {
                    showPortfolio();
                    initFirebaseConnection();
                }, 1500);
            } else {
                // Add error effects
                const inputs = document.querySelectorAll('input');
                inputs.forEach(input => {
                    input.style.borderColor = '#ff5757';
                    input.style.boxShadow = '0 0 0 4px rgba(255, 87, 87, 0.2)';
                    
                    setTimeout(() => {
                        input.style.borderColor = 'rgba(255, 255, 255, 0.15)';
                        input.style.boxShadow = 'none';
                    }, 1000);
                });
                
                showAlert('Invalid Username Or Password!. Please try again.', 'error');
            }
        }

        // Show portfolio page dengan logo centang untuk DeveloperXstev
        function showPortfolio() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('portfolioPage').classList.remove('hidden');
            
            // Set username in portfolio page dengan badge jika sesuai
            const currentUsernameElement = document.getElementById('currentUsername');
            const footerUsernameElement = document.getElementById('footerUsername');
            
            // Periksa apakah username adalah DeveloperXstev
            if (currentUser && currentUser.toLowerCase() === 'developerxstev') {
                // Tambahkan badge centang di header
                currentUsernameElement.innerHTML = `
                    <div class="username-with-badge">
                        ${currentUser}
                        <span class="verified-badge">
                            <img src="https://files.sitestatic.net/assets/imgs/verify_sm.png" alt="Verified" title="Verified User">
                        </span>
                        <span class="admin-badge">ADMIN</span>
                    </div>
                `;
                
                // Tambahkan badge centang di footer
                footerUsernameElement.innerHTML = `
                    ${currentUser}
                    <img src="https://files.sitestatic.net/assets/imgs/verify_sm.png" alt="Verified">
                    <span class="admin-badge">ADMIN</span>
                `;
                
                // Show admin tab
                document.getElementById('adminTab').style.display = 'flex';
                document.getElementById('mobileAdminTab').style.display = 'flex';
            } else {
                // Untuk user lain, tampilkan biasa
                currentUsernameElement.innerHTML = `<div>${currentUser}</div>`;
                footerUsernameElement.textContent = currentUser;
            }
            
            // Initialize portfolio system
            initializePortfolio();
        }

        // ==================== ADMIN PANEL FUNCTIONS ====================
        
        // Load admin data from Firebase
        function loadAdminData() {
            if (!isAdmin || !firebaseConnected) return;
            
            loadUsers();
            loadActivityLog();
            loadRealTimeStats();
        }

        // Load users from Firebase
        function loadUsers() {
            const usersRef = database.ref('users');
            usersRef.on('value', (snapshot) => {
                const users = snapshot.val();
                updateUserTable(users);
                updateUserStats(users);
            });
        }

        // Update user table
        function updateUserTable(users) {
            const tableBody = document.getElementById('userTableBody');
            if (!tableBody) return;
            
            if (!users || Object.keys(users).length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center;">
                            No users found in database
                        </td>
                    </tr>
                `;
                return;
            }
            
            let tableHTML = '';
            Object.keys(users).forEach(username => {
                const user = users[username];
                const lastLogin = user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'Never';
                const status = user.isOnline ? 'Online' : (user.isSuspended ? 'Suspended' : 'Offline');
                const statusClass = user.isOnline ? 'status-active' : (user.isSuspended ? 'status-suspended' : '');
                const roleClass = `role-${user.role || 'player'}`;
                
                tableHTML += `
                    <tr>
                        <td><strong>${username}</strong></td>
                        <td><span class="role-badge ${roleClass}">${user.role || 'player'}</span></td>
                        <td><span class="status-badge ${statusClass}">${status}</span></td>
                        <td>${lastLogin}</td>
                        <td>
                            <button onclick="toggleSuspend('${username}', ${user.isSuspended || false})" class="btn btn-warning" style="padding: 5px 10px; font-size: 12px;">
                                <i class="fas ${user.isSuspended ? 'fa-user-check' : 'fa-user-slash'}"></i>
                                ${user.isSuspended ? 'Unsuspend' : 'Suspend'}
                            </button>
                            <button onclick="deleteUser('${username}')" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px; margin-left: 5px;">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
        }

        // Update user statistics
        function updateUserStats(users) {
            if (!users) {
                document.getElementById('totalUsers').textContent = '0';
                document.getElementById('activeUsers').textContent = '0';
                document.getElementById('suspendedUsers').textContent = '0';
                document.getElementById('activePlayers').textContent = '0';
                return;
            }
            
            const userArray = Object.values(users);
            const totalUsers = userArray.length;
            const activeUsers = userArray.filter(user => user.isOnline).length;
            const suspendedUsers = userArray.filter(user => user.isSuspended).length;
            
            // Calculate active players in last 24 hours
            const now = new Date();
            const activePlayers = userArray.filter(user => {
                if (!user.lastLogin) return false;
                const lastLogin = new Date(user.lastLogin);
                const diffHours = (now - lastLogin) / (1000 * 60 * 60);
                return diffHours <= 24;
            }).length;
            
            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('activeUsers').textContent = activeUsers;
            document.getElementById('suspendedUsers').textContent = suspendedUsers;
            document.getElementById('activePlayers').textContent = activePlayers;
        }

        // Load activity log
        function loadActivityLog() {
            const activitiesRef = database.ref('activities').limitToLast(50);
            activitiesRef.on('value', (snapshot) => {
                const activities = snapshot.val();
                updateActivityLog(activities);
            });
        }

        // Update activity log display
        function updateActivityLog(activities) {
            const logContainer = document.getElementById('activityLog');
            if (!logContainer) return;
            
            if (!activities || Object.keys(activities).length === 0) {
                logContainer.innerHTML = `
                    <div class="log-entry">
                        <div class="log-time">No activities yet</div>
                        <div class="log-user">System</div>
                        <div class="log-action">No activity recorded</div>
                        <div class="log-details">-</div>
                    </div>
                `;
                return;
            }
            
            let logHTML = '';
            // Convert to array and sort by timestamp (newest first)
            const activitiesArray = Object.values(activities)
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            activitiesArray.forEach(activity => {
                const time = new Date(activity.timestamp).toLocaleTimeString();
                const date = new Date(activity.timestamp).toLocaleDateString();
                
                logHTML += `
                    <div class="log-entry">
                        <div class="log-time">${date} ${time}</div>
                        <div class="log-user">${activity.username}</div>
                        <div class="log-action">${activity.action}</div>
                        <div class="log-details">${activity.details}</div>
                    </div>
                `;
            });
            
            logContainer.innerHTML = logHTML;
        }

        // Load real-time stats
        function loadRealTimeStats() {
            // Update online players
            const onlinePlayersDiv = document.getElementById('onlinePlayers');
            if (onlinePlayersDiv) {
                setInterval(() => {
                    database.ref('users').once('value').then(snapshot => {
                        const users = snapshot.val();
                        if (users) {
                            const onlineCount = Object.values(users).filter(user => user.isOnline).length;
                            onlinePlayersDiv.innerHTML = `
                                <div class="player-status ${onlineCount > 0 ? 'online' : 'offline'}"></div>
                                <span>${onlineCount} players online</span>
                            `;
                        }
                    });
                }, 5000);
            }
        }

        // Toggle user suspend status
        function toggleSuspend(username, currentlySuspended) {
            if (!confirm(`Are you sure you want to ${currentlySuspended ? 'unsuspend' : 'suspend'} ${username}?`)) {
                return;
            }
            
            const userRef = database.ref('users/' + username);
            userRef.update({
                isSuspended: !currentlySuspended
            }).then(() => {
                recordActivity(currentUser, 'user_suspend', 
                    `${currentlySuspended ? 'Unsuspended' : 'Suspended'} user ${username}`);
                showAdminAlert(`User ${username} ${currentlySuspended ? 'unsuspended' : 'suspended'} successfully`, 'success');
            }).catch(error => {
                showAdminAlert(`Error: ${error.message}`, 'error');
            });
        }

        // Delete user
        function deleteUser(username) {
            if (username === currentUser) {
                showAdminAlert('You cannot delete your own account!', 'error');
                return;
            }
            
            if (!confirm(`Are you sure you want to permanently delete user ${username}? This action cannot be undone.`)) {
                return;
            }
            
            const userRef = database.ref('users/' + username);
            userRef.remove().then(() => {
                recordActivity(currentUser, 'user_delete', `Deleted user ${username}`);
                showAdminAlert(`User ${username} deleted successfully`, 'success');
            }).catch(error => {
                showAdminAlert(`Error: ${error.message}`, 'error');
            });
        }

        // Show admin alert
        function showAdminAlert(message, type) {
            alert(`${type.toUpperCase()}: ${message}`);
        }

        // Add user form submission
        document.addEventListener('DOMContentLoaded', function() {
            const addUserForm = document.getElementById('addUserForm');
            if (addUserForm) {
                addUserForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const username = document.getElementById('newUsername').value.trim();
                    const password = document.getElementById('newPassword').value.trim();
                    const role = document.getElementById('newRole').value;
                    
                    if (!username || !password) {
                        showAdminAlert('Please fill in all fields', 'error');
                        return;
                    }
                    
                    // Check if user already exists in local accounts
                    if (validAccounts[username]) {
                        showAdminAlert('User already exists in local accounts', 'error');
                        return;
                    }
                    
                    // Add to Firebase
                    const userRef = database.ref('users/' + username);
                    userRef.set({
                        username: username,
                        password: password, // Note: In production, use proper authentication!
                        role: role,
                        isOnline: false,
                        isSuspended: false,
                        createdAt: new Date().toISOString(),
                        lastLogin: null
                    }).then(() => {
                        // Add to local accounts for immediate login
                        validAccounts[username] = password;
                        
                        recordActivity(currentUser, 'user_add', `Added new ${role}: ${username}`);
                        showAdminAlert(`User ${username} added successfully as ${role}`, 'success');
                        
                        // Reset form
                        addUserForm.reset();
                    }).catch(error => {
                        showAdminAlert(`Error: ${error.message}`, 'error');
                    });
                });
            }

            // Refresh users button
            const refreshUsersBtn = document.getElementById('refreshUsers');
            if (refreshUsersBtn) {
                refreshUsersBtn.addEventListener('click', function() {
                    loadUsers();
                    showAdminAlert('Users list refreshed', 'success');
                });
            }
        });

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Update user status in Firebase
                if (firebaseConnected && currentUser) {
                    recordActivity(currentUser, 'logout', 'User logged out');
                    updateUserStatus(currentUser, false);
                }
                
                currentUser = null;
                isAdmin = false;
                sessionStorage.removeItem('loggedInUser');
                document.getElementById('portfolioPage').classList.add('hidden');
                document.getElementById('loginPage').classList.remove('hidden');
                
                // Reset form
                document.getElementById('username').value = '';
                document.getElementById('key').value = '';
                document.getElementById('loginBtn').textContent = 'ACCESS PORTFOLIO';
                document.getElementById('loginBtn').style.background = 'linear-gradient(135deg, #5227FF, #B19EEF, #FF9FFC)';
            }
        }

        // Event listeners for login
        document.getElementById('loginBtn').addEventListener('click', handleLogin);
        document.getElementById('logoutBtn').addEventListener('click', logout);

        // Mobile logout
        document.getElementById('mobileLogoutBtn').addEventListener('click', logout);

        // Enter key to login
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !document.getElementById('loginPage').classList.contains('hidden')) {
                handleLogin();
            }
        });

        // ==================== PORTFOLIO SYSTEM ====================
        // Currency locales for formatting
        const currencyLocales = {
            'IDR': 'id-ID',
            'USD': 'en-US',
            'EUR': 'en-US',
            'GBP': 'en-GB',
            'JPY': 'ja-JP',
            'AUD': 'en-AU',
            'CAD': 'en-CA',
            'CHF': 'de-CH',
            'SEK': 'sv-SE',
            'NOK': 'no-NO'
        };

        // Function to format currency based on selected currency
        function formatCurrency(amount) {
            const locale = currencyLocales[selectedCurrency] || 'en-US';
            const formatter = new Intl.NumberFormat(locale, { style: 'currency', currency: selectedCurrency });
            return formatter.format(Math.round(amount));
        }

        // Global variables for portfolio
        let transactions = [];
        let previousPrices = {};
        let currentPrices = {};
        let hourlyChanges = {};
        let performanceChart = null;
        let chartType = 'value';
        let lastSuccessfulUpdate = 0;
        let currentApi = 'CoinGecko';
        let apiStatus = 'live';
        let selectedCoin = '';
        let selectedCoinForPrice = 'BTC'; // Default coin for price display
        let selectedCurrency = 'IDR'; // Default currency

        // Coin data (will be populated from CoinGecko)
        let coins = [];

        // Daftar fallback coins untuk koin-coin baru
        const fallbackCoins = [
            { id: 'zora', symbol: 'ZORA', name: 'Zora', logo: 'https://via.placeholder.com/30x30/2a2b36/ffffff?text=Z' },
            { id: 'troll-solana', symbol: 'TROLLSOL', name: 'Troll Solana', logo: 'https://via.placeholder.com/30x30/2a2b36/ffffff?text=T' },
            { id: 'jelly-jelly', symbol: 'JELLYJELLY', name: 'Jelly Jelly', logo: 'https://via.placeholder.com/30x30/2a2b36/ffffff?text=J' },
            { id: 'moonpig', symbol: 'MOONPIG', name: 'MoonPig', logo: 'https://via.placeholder.com/30x30/2a2b36/ffffff?text=M' },
            { id: 'ethena', symbol: 'ENA', name: 'Ethena', logo: 'https://via.placeholder.com/30x30/2a2b36/ffffff?text=E' },
            { id: 'pengu', symbol: 'PENGU', name: 'Pengu', logo: 'https://via.placeholder.com/30x30/2a2b36/ffffff?text=P' },
            { id: 'fartcoin', symbol: 'FART', name: 'Fart Coin', logo: 'https://via.placeholder.com/30x30/2a2b36/ffffff?text=F' }
        ];

        // Initialize portfolio system
        function initializePortfolio() {
            // Theme toggle functionality
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = themeToggle.querySelector('i');
            
            // Check for saved theme or use default
            const storedTheme = localStorage.getItem('portfolio-theme');
            
            // Apply theme
            if (storedTheme === 'light') {
                document.body.classList.add('light-theme');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            } else {
                document.body.classList.remove('light-theme');
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
            }
            
            // Add click event listener
            themeToggle.addEventListener('click', function() {
                // Toggle theme class on body
                document.body.classList.toggle('light-theme');
                
                // Update icon
                if (document.body.classList.contains('light-theme')) {
                    themeIcon.classList.remove('fa-moon');
                    themeIcon.classList.add('fa-sun');
                    localStorage.setItem('portfolio-theme', 'light');
                } else {
                    themeIcon.classList.remove('fa-sun');
                    themeIcon.classList.add('fa-moon');
                    localStorage.setItem('portfolio-theme', 'dark');
                }
                
                // Update chart if exists
                if (performanceChart) {
                    setTimeout(() => {
                        performanceChart.update();
                    }, 100);
                }
            });

            // Mobile menu functionality
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuClose = document.getElementById('mobileMenuClose');
            const mobileTabs = document.querySelectorAll('.mobile-menu .tab');
            
            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', () => {
                    mobileMenu.classList.add('active');
                });
            }
            
            if (mobileMenuClose) {
                mobileMenuClose.addEventListener('click', () => {
                    mobileMenu.classList.remove('active');
                });
            }
            
            // Tab switching for mobile
            mobileTabs.forEach(tab => {
                if (!tab.id.includes('Logout')) { // Skip logout button
                    tab.addEventListener('click', () => {
                        const tabId = tab.getAttribute('data-tab');
                        switchTab(tabId);
                        mobileMenu.classList.remove('active');
                    });
                }
            });

            // Load transactions from localStorage
            loadTransactions();
            
            // Fetch coin list and start price updates
            fetchCoinList().then(() => {
                updatePrices();
                setInterval(updatePrices, 30000); // Update every 30 seconds
            });

            // Setup event listeners for portfolio
            setupPortfolioEventListeners();
        }

        // Switch tab function
        function switchTab(tabId) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            // Add active class to clicked tab and corresponding content
            const desktopTab = document.querySelector(`.tab[data-tab="${tabId}"]`);
            const mobileTab = document.querySelector(`.mobile-menu .tab[data-tab="${tabId}"]`);
            
            if (desktopTab) desktopTab.classList.add('active');
            if (mobileTab) mobileTab.classList.add('active');
            
            document.getElementById(tabId).classList.add('active');
            
            // Update mobile tab indicator
            const currentMobileTab = document.getElementById('currentMobileTab');
            if (currentMobileTab) {
                const tabNames = {
                    'transactions': 'Transactions',
                    'dashboard': 'Dashboard',
                    'admin': 'Admin Panel'
                };
                currentMobileTab.textContent = tabNames[tabId] || tabId;
            }
            
            // Update dashboard when switching to it
            if (tabId === 'dashboard') {
                updateDashboard();
            } else if (tabId === 'transactions') {
                updateMobileTransactionList();
            } else if (tabId === 'admin' && isAdmin) {
                loadAdminData();
            }
        }

        // Load transactions from localStorage
        function loadTransactions() {
            const savedTransactions = localStorage.getItem('cryptoTransactions');
            if (savedTransactions) {
                transactions = JSON.parse(savedTransactions);
                updateCoinSelector();
                updateTransactionTable();
                updateMobileTransactionList();
                updateDashboard();
            }
        }

        // Save transactions to localStorage
        function saveTransactions() {
            localStorage.setItem('cryptoTransactions', JSON.stringify(transactions));
            updateCoinSelector();
            updateDashboard();
            updateMobileTransactionList();
        }

        // Update mobile transaction list
        function updateMobileTransactionList() {
            const mobileList = document.getElementById('mobileTransactionList');
            if (!mobileList) return;
            
            mobileList.innerHTML = '';
            
            // Filter transactions by selected coin and only include 'buy' transactions
            const filteredTransactions = selectedCoin ? 
                transactions.filter(tx => tx.coin === selectedCoin && tx.type === 'buy') : 
                transactions.filter(tx => tx.type === 'buy');
            
            if (filteredTransactions.length === 0) {
                const emptyMsg = document.createElement('div');
                emptyMsg.className = 'mobile-transaction-item';
                emptyMsg.style.textAlign = 'center';
                emptyMsg.style.padding = '30px';
                emptyMsg.innerHTML = '<p>No buy transactions yet. Add some buy transactions to get started.</p>';
                mobileList.appendChild(emptyMsg);
                return;
            }
            
            filteredTransactions.forEach(tx => {
                const coin = coins.find(c => c.symbol === tx.coin);
                const currentPrice = currentPrices[tx.coin] || 0;
                const currentValue = tx.quantity * currentPrice;
                const pnl = currentValue - (tx.quantity * tx.price);
                const pnlPercentage = ((currentPrice - tx.price) / tx.price * 100).toFixed(2);
                
                const item = document.createElement('div');
                item.className = 'mobile-transaction-item';
                
                const header = document.createElement('div');
                header.className = 'mobile-transaction-header';
                
                const coinInfo = document.createElement('div');
                coinInfo.className = 'mobile-transaction-coin';
                
                if (coin && coin.logo) {
                    coinInfo.innerHTML = `
                        <img src="${coin.logo}" alt="${coin.name}" style="width: 30px; height: 30px; border-radius: 50%;">
                        <div>
                            <div style="font-size: 16px;">${coin.name}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">${tx.coin}</div>
                        </div>
                    `;
                } else {
                    coinInfo.innerHTML = `<div>${tx.coin}</div>`;
                }
                
                const pnlIndicator = document.createElement('div');
                pnlIndicator.innerHTML = `
                    <div style="font-weight: bold; color: ${pnl >= 0 ? 'var(--success)' : 'var(--danger)'};">
                        ${pnl >= 0 ? '+' : ''}${pnlPercentage}%
                    </div>
                    <div style="font-size: 12px; color: ${pnl >= 0 ? 'var(--success)' : 'var(--danger)'};">
                        ${pnl >= 0 ? '+' : ''}${formatCurrency(pnl)}
                    </div>
                `;
                
                header.appendChild(coinInfo);
                header.appendChild(pnlIndicator);
                
                const details = document.createElement('div');
                details.className = 'mobile-transaction-details';
                
                details.innerHTML = `
                    <div class="mobile-detail-item">
                        <div class="mobile-detail-label">Date</div>
                        <div class="mobile-detail-value">${tx.date}</div>
                    </div>
                    <div class="mobile-detail-item">
                        <div class="mobile-detail-label">Quantity</div>
                        <div class="mobile-detail-value">${tx.quantity.toLocaleString('en-US', { maximumFractionDigits: 7 })}</div>
                    </div>
                    <div class="mobile-detail-item">
                        <div class="mobile-detail-label">Buy Price</div>
                        <div class="mobile-detail-value">${formatCurrency(tx.price)}</div>
                    </div>
                    <div class="mobile-detail-item">
                        <div class="mobile-detail-label">Current Value</div>
                        <div class="mobile-detail-value">${formatCurrency(currentValue)}</div>
                    </div>
                `;
                
                item.appendChild(header);
                item.appendChild(details);
                mobileList.appendChild(item);
            });
        }

        // Update coin selector chips
        function updateCoinSelector() {
            const coinSelector = document.getElementById('coinSelector');
            if (!coinSelector) return;
            
            coinSelector.innerHTML = '';
            
            // Get unique coins from transactions
            const uniqueCoins = [...new Set(transactions.map(tx => tx.coin))];
            if (uniqueCoins.length === 0) {
                coinSelector.innerHTML = '<p>No coins in portfolio yet</p>';
                return;
            }
            
            // Add "All" chip
            const allChip = document.createElement('div');
            allChip.className = `coin-chip ${selectedCoin === '' ? 'active' : ''}`;
            allChip.innerHTML = '<i class="fas fa-coins"></i> All Coins';
            allChip.addEventListener('click', () => {
                selectedCoin = '';
                updateCoinSelector();
                updateDashboard();
                updateTransactionTable();
                updateMobileTransactionList();
            });
            coinSelector.appendChild(allChip);
            
            // Add chips for each coin
            uniqueCoins.forEach(symbol => {
                const coin = coins.find(c => c.symbol === symbol);
                if (!coin) return;
                
                const chip = document.createElement('div');
                chip.className = `coin-chip ${selectedCoin === symbol ? 'active' : ''}`;
                chip.innerHTML = `
                    <img src="${coin.logo}" alt="${coin.name}" class="coin-logo">
                    ${coin.name} (${coin.symbol})
                `;
                chip.addEventListener('click', () => {
                    selectedCoin = symbol;
                    updateCoinSelector();
                    updateDashboard();
                    updateTransactionTable();
                    updateMobileTransactionList();
                });
                coinSelector.appendChild(chip);
            });
        }

        // Fetch coin list from CoinGecko
        async function fetchCoinList() {
            const cacheKey = 'coinList';
            const cacheExpiry = 60 * 60 * 1000; // 1 hour
            const cachedData = localStorage.getItem(cacheKey);
            const now = Date.now();
            
            // Show loading state in dropdowns
            const priceSelector = document.getElementById('priceCoinSelector');
            const coinSelector = document.getElementById('coin');
            if (priceSelector) priceSelector.innerHTML = '<option value="">Loading coins...</option>';
            if (coinSelector) coinSelector.innerHTML = '<option value="">Loading coins...</option>';
            
            // Try to use cached data if valid
            if (cachedData) {
                const { data, timestamp } = JSON.parse(cachedData);
                if (now - timestamp < cacheExpiry) {
                    coins = data;
                    populateCoinDropdowns();
                    return;
                }
            }
            
            try {
                // Fetch only top 100 coins for performance
                const response = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=${selectedCurrency.toLowerCase()}&order=market_cap_desc&per_page=100&page=1&sparkline=false`);
                const coinData = await response.json();
                
                // Map data to our coin structure
                coins = coinData.map(coin => ({
                    id: coin.id,
                    symbol: coin.symbol.toUpperCase(),
                    name: coin.name,
                    logo: coin.image
                }));
                
                // Add fallback coins if they don't exist in the API response
                for (const fallbackCoin of fallbackCoins) {
                    if (!coins.some(c => c.symbol === fallbackCoin.symbol)) {
                        coins.push(fallbackCoin);
                    }
                }
                
                // Save to localStorage
                localStorage.setItem(cacheKey, JSON.stringify({ data: coins, timestamp: now }));
                
                // Populate dropdowns
                populateCoinDropdowns();
            } catch (error) {
                console.error('Failed to fetch coin list:', error);
                
                // Fallback to default coins if available
                if (cachedData) {
                    const { data } = JSON.parse(cachedData);
                    coins = data;
                    populateCoinDropdowns();
                } else {
                    // Use fallback coins as last resort
                    coins = [
                        // Popular coins
                        { id: 'bitcoin', symbol: 'BTC', name: 'Bitcoin', logo: 'https://coin-images.coingecko.com/coins/images/1/small/bitcoin.png' },
                        { id: 'ethereum', symbol: 'ETH', name: 'Ethereum', logo: 'https://coin-images.coingecko.com/coins/images/279/small/ethereum.png' },
                        { id: 'binancecoin', symbol: 'BNB', name: 'Binance Coin', logo: 'https://coin-images.coingecko.com/coins/images/825/small/bnb-icon2_2x.png' },
                        // Add the requested coins including FARTCOIN
                        ...fallbackCoins
                    ];
                    populateCoinDropdowns();
                }
            }
        }

        // Populate coin dropdowns
        function populateCoinDropdowns() {
            const priceSelector = document.getElementById('priceCoinSelector');
            const coinSelector = document.getElementById('coin');
            
            if (!priceSelector || !coinSelector) return;
            
            // Clear dropdowns
            priceSelector.innerHTML = '';
            coinSelector.innerHTML = '';
            
            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Select Coin';
            priceSelector.appendChild(defaultOption);
            coinSelector.appendChild(defaultOption.cloneNode(true));
            
            // Add coins to dropdowns
            coins.forEach(coin => {
                const priceOption = document.createElement('option');
                priceOption.value = coin.symbol;
                priceOption.textContent = `${coin.name} (${coin.symbol})`;
                priceSelector.appendChild(priceOption);
                
                const coinOption = document.createElement('option');
                coinOption.value = coin.symbol;
                coinOption.textContent = `${coin.name} (${coin.symbol})`;
                coinSelector.appendChild(coinOption);
            });
            
            // Set default selected coin
            priceSelector.value = selectedCoinForPrice;
        }

        // Enhanced price fetching with multiple endpoints
        async function fetchPriceWithRetry(maxRetries = 3, delayMs = 1000) {
            const endpoints = [
                {
                    name: 'CoinGecko',
                    url: `https://api.coingecko.com/api/v3/simple/price?ids=${coins.map(c => c.id).join(',')}&vs_currencies=${selectedCurrency.toLowerCase()}&include_24hr_change=true`,
                    handler: async (response) => {
                        const data = await response.json();
                        const prices = {};
                        const changes = {};
                        coins.forEach(coin => {
                            const vsCurr = selectedCurrency.toLowerCase();
                            if (data[coin.id] && data[coin.id][vsCurr]) {
                                prices[coin.symbol] = data[coin.id][vsCurr];
                                // Get 24-hour percentage change
                                if (data[coin.id][`${vsCurr}_24h_change`]) {
                                    changes[coin.symbol] = data[coin.id][`${vsCurr}_24h_change`];
                                }
                            } else {
                                prices[coin.symbol] = currentPrices[coin.symbol] || 0;
                            }
                        });
                        return { prices, changes };
                    }
                },
                {
                    name: 'Binance',
                    url: 'https://api.binance.com/api/v3/ticker/price',
                    handler: async (response) => {
                        const data = await response.json();
                        const prices = {};
                        const currUpper = selectedCurrency.toUpperCase();
                        data.forEach(item => {
                            if (item.symbol.endsWith(currUpper)) {
                                const symbol = item.symbol.replace(currUpper, '');
                                if (coins.some(c => c.symbol === symbol)) {
                                    prices[symbol] = parseFloat(item.price);
                                }
                            }
                        });
                        coins.forEach(coin => {
                            if (!(coin.symbol in prices)) {
                                prices[coin.symbol] = currentPrices[coin.symbol] || 0;
                            }
                        });
                        return { prices, changes: {} };
                    }
                }
            ];
            
            for (let attempt = 1; attempt <= maxRetries; attempt++) {
                for (const endpoint of endpoints) {
                    try {
                        const response = await fetch(endpoint.url);
                        if (!response.ok) continue;
                        const result = await endpoint.handler(response);
                        if (Object.keys(result.prices).length > 0) {
                            currentApi = endpoint.name;
                            apiStatus = 'live';
                            return result;
                        }
                    } catch (error) {
                        console.log(`Failed to fetch from ${endpoint.name}: ${error.message}`);
                    }
                }
                if (attempt < maxRetries) {
                    await new Promise(resolve => setTimeout(resolve, delayMs));
                }
            }
            
            currentApi = 'Fallback';
            apiStatus = 'fallback';
            const fallbackPrices = { ...currentPrices };
            return { prices: fallbackPrices, changes: {} };
        }

        // Update transaction table
        function updateTransactionTable() {
            let totalValue = 0, totalPNL = 0, totalInvestment = 0;
            const tableBody = document.getElementById('transactionTable');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            // Filter transactions by selected coin and only include 'buy' transactions
            const filteredTransactions = selectedCoin ? 
                transactions.filter(tx => tx.coin === selectedCoin && tx.type === 'buy') : 
                transactions.filter(tx => tx.type === 'buy');
            
            if (filteredTransactions.length === 0) {
                const row = tableBody.insertRow();
                const cell = row.insertCell(0);
                cell.colSpan = 10;
                cell.textContent = 'No buy transactions yet. Add some buy transactions to get started.';
                cell.style.textAlign = 'center';
                return;
            }
            
            filteredTransactions.forEach(tx => {
                const coin = coins.find(c => c.symbol === tx.coin);
                const currentPrice = currentPrices[tx.coin] || 0;
                const currentValue = tx.quantity * currentPrice;
                const pnl = currentValue - (tx.quantity * tx.price);
                const pnlPercentage = ((currentPrice - tx.price) / tx.price * 100).toFixed(2);
                
                totalValue += currentValue;
                totalPNL += pnl;
                totalInvestment += tx.quantity * tx.price;
                
                const row = tableBody.insertRow();
                row.insertCell(0).textContent = tx.date;
                
                if (coin) {
                    row.insertCell(1).innerHTML = `<img src="${coin.logo}" alt="${coin.name} Logo" class="coin-logo">`;
                } else {
                    row.insertCell(1).textContent = '';
                }
                
                row.insertCell(2).textContent = coin ? coin.name : tx.coin;
                row.insertCell(3).textContent = tx.coin;
                row.insertCell(4).textContent = formatCurrency(tx.quantity * tx.price);
                row.insertCell(5).textContent = formatCurrency(tx.price);
                row.insertCell(6).textContent = tx.quantity.toLocaleString('en-US', { maximumFractionDigits: 7 });
                row.insertCell(7).textContent = formatCurrency(currentValue);
                row.insertCell(8).textContent = `${pnlPercentage}%`;
                row.insertCell(9).textContent = pnl < 0 ? `(${formatCurrency(Math.abs(pnl))})` : `+${formatCurrency(pnl)}`;
                row.cells[9].className = pnl < 0 ? 'negative' : 'positive';
            });
            
            const totalValueEl = document.getElementById('totalValue');
            const totalPNLValueEl = document.getElementById('totalPNLValue');
            
            if (totalValueEl) totalValueEl.textContent = formatCurrency(totalValue);
            if (totalPNLValueEl) {
                totalPNLValueEl.textContent = totalPNL < 0 ? `(${formatCurrency(Math.abs(totalPNL))})` : `+${formatCurrency(totalPNL)}`;
                totalPNLValueEl.className = totalPNL < 0 ? 'negative' : 'positive';
            }
        }

        // Update dashboard
        function updateDashboard() {
            if (transactions.length === 0) {
                document.getElementById('totalInvestment').textContent = formatCurrency(0);
                document.getElementById('currentValue').textContent = formatCurrency(0);
                document.getElementById('profitLoss').textContent = formatCurrency(0);
                document.getElementById('bestPerformer').textContent = '-';
                document.getElementById('profitPercentage').textContent = '0%';
                document.getElementById('averagePrice').textContent = '-';
                updatePerformanceChart([]);
                updateRecentTransactions([]);
                return;
            }
            
            // Filter transactions by selected coin
            const filteredTransactions = selectedCoin ? 
                transactions.filter(tx => tx.coin === selectedCoin) : 
                transactions;
            
            // Calculate portfolio metrics
            const coinsData = {};
            filteredTransactions.forEach(tx => {
                if (!coinsData[tx.coin]) {
                    const coin = coins.find(c => c.symbol === tx.coin);
                    coinsData[tx.coin] = {
                        symbol: tx.coin,
                        name: coin ? coin.name : tx.coin,
                        logo: coin ? coin.logo : '',
                        totalBought: 0,
                        totalSold: 0,
                        totalInvested: 0,
                        totalValue: 0,
                        pnl: 0
                    };
                }
                const data = coinsData[tx.coin];
                if (tx.type === 'buy') {
                    data.totalBought += tx.quantity;
                    data.totalInvested += tx.quantity * tx.price;
                } else {
                    data.totalSold += tx.quantity;
                }
            });
            
            // Calculate current values
            let totalPortfolioValue = 0;
            let totalInvestment = 0;
            let totalPNL = 0;
            let bestPerformer = { symbol: '', pnlPercentage: -Infinity };
            
            Object.keys(coinsData).forEach(symbol => {
                const data = coinsData[symbol];
                const currentPrice = currentPrices[symbol] || 0;
                const holdings = data.totalBought - data.totalSold;
                data.totalValue = holdings * currentPrice;
                data.pnl = data.totalValue - data.totalInvested;
                const pnlPercentage = data.totalInvested > 0 ? (data.pnl / data.totalInvested) * 100 : 0;
                
                if (pnlPercentage > bestPerformer.pnlPercentage) {
                    bestPerformer = { symbol, pnlPercentage };
                }
                
                totalPortfolioValue += data.totalValue;
                totalInvestment += data.totalInvested;
                totalPNL += data.pnl;
            });
            
            // Update card values
            document.getElementById('totalInvestment').textContent = formatCurrency(totalInvestment);
            document.getElementById('currentValue').textContent = formatCurrency(totalPortfolioValue);
            document.getElementById('profitLoss').textContent = totalPNL < 0 ? `(${formatCurrency(Math.abs(totalPNL))})` : `+${formatCurrency(totalPNL)}`;
            
            // Update best performer
            if (bestPerformer.symbol) {
                const coin = coins.find(c => c.symbol === bestPerformer.symbol);
                if (coin) {
                    document.getElementById('bestPerformer').innerHTML = `
                        <div class="coin-details">
                            <img src="${coin.logo}" alt="${coin.name}" class="coin-logo">
                            ${coin.symbol}: ${bestPerformer.pnlPercentage.toFixed(2)}%
                        </div>
                    `;
                }
            }
            
            document.getElementById('profitPercentage').textContent = `${((totalPNL / totalInvestment * 100) || 0).toFixed(2)}%`;
            
            // Update average price (only for single selected coin)
            if (selectedCoin) {
                const data = coinsData[selectedCoin];
                if (data && data.totalBought > 0) {
                    const average = data.totalInvested / data.totalBought;
                    document.getElementById('averagePrice').textContent = formatCurrency(average);
                } else {
                    document.getElementById('averagePrice').textContent = '-';
                }
            } else {
                document.getElementById('averagePrice').textContent = '-';
            }
            
            // Update dashboard price display
            const dashboardPriceDisplay = document.getElementById('dashboardPriceValue');
            const dashboardPriceIndicator = document.getElementById('dashboardPriceIndicator');
            if (dashboardPriceDisplay) dashboardPriceDisplay.textContent = formatCurrency(totalPortfolioValue);
            if (dashboardPriceIndicator) {
                dashboardPriceIndicator.textContent = totalPNL >= 0 ? '' : '';
                dashboardPriceIndicator.className = totalPNL >= 0 ? 'price-indicator positive' : 'price-indicator negative';
            }
            
            // Update performance chart and recent transactions
            updatePerformanceChart(filteredTransactions);
            updateRecentTransactions(filteredTransactions);
        }

        // Update recent transactions table
        function updateRecentTransactions(transactions) {
            const recentTransactionsEl = document.getElementById('recentTransactions');
            if (!recentTransactionsEl) return;
            
            const tbody = recentTransactionsEl.querySelector('tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Show last 5 transactions (most recent first)
            const recent = [...transactions].reverse().slice(0, 5);
            
            if (recent.length === 0) {
                const row = tbody.insertRow();
                const cell = row.insertCell(0);
                cell.colSpan = 6;
                cell.textContent = 'No transactions yet';
                cell.style.textAlign = 'center';
                return;
            }
            
            recent.forEach(tx => {
                const coin = coins.find(c => c.symbol === tx.coin);
                const row = tbody.insertRow();
                const value = tx.quantity * tx.price;
                
                row.insertCell(0).textContent = tx.date;
                if (coin) {
                    row.insertCell(1).innerHTML = `<img src="${coin.logo}" alt="${tx.coin}" class="coin-logo"> ${tx.coin}`;
                } else {
                    row.insertCell(1).textContent = tx.coin;
                }
                row.insertCell(2).textContent = tx.type.toUpperCase();
                row.insertCell(3).textContent = formatCurrency(tx.price);
                row.insertCell(4).textContent = tx.quantity.toFixed(6);
                row.insertCell(5).textContent = formatCurrency(value);
            });
        }

        // Create or update performance chart
        function updatePerformanceChart(transactions) {
            const ctx = document.getElementById('performanceChart');
            const placeholder = document.getElementById('chartPlaceholder');
            
            if (!ctx || !placeholder) return;
            
            // Clear existing chart if it exists
            if (performanceChart) {
                performanceChart.destroy();
                performanceChart = null;
            }
            
            // If no transactions, show placeholder
            if (transactions.length === 0) {
                ctx.style.display = 'none';
                placeholder.style.display = 'block';
                return;
            }
            
            // Hide placeholder
            ctx.style.display = 'block';
            placeholder.style.display = 'none';
            
            // Sort transactions by date
            const sortedTransactions = [...transactions].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Calculate cumulative values
            let cumulativeValue = 0;
            let cumulativeInvestment = 0;
            const dates = [];
            const valueData = [];
            const investmentData = [];
            
            // Process each transaction and calculate cumulative values
            sortedTransactions.forEach(tx => {
                if (tx.type === 'buy') {
                    cumulativeInvestment += tx.quantity * tx.price;
                }
                
                // Calculate current value for this transaction
                const currentPrice = currentPrices[tx.coin] || 0;
                cumulativeValue = 0; // Recalculate total value for all transactions up to this point
                const transactionsUntilNow = sortedTransactions.filter(t => new Date(t.date) <= new Date(tx.date));
                
                transactionsUntilNow.forEach(t => {
                    const price = currentPrices[t.coin] || 0;
                    if (t.type === 'buy') {
                        cumulativeValue += t.quantity * price;
                    } else {
                        cumulativeValue -= t.quantity * price;
                    }
                });
                
                dates.push(tx.date);
                valueData.push(cumulativeValue);
                investmentData.push(cumulativeInvestment);
            });
            
            // Create chart
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Portfolio Value',
                        data: valueData,
                        backgroundColor: 'rgba(78, 205, 196, 0.2)',
                        borderColor: '#4ecdc4',
                        borderWidth: 2,
                        pointRadius: 4,
                        pointBackgroundColor: '#4ecdc4',
                        tension: 0.3,
                        fill: true
                    }, {
                        label: 'Total Investment',
                        data: investmentData,
                        backgroundColor: 'rgba(255, 107, 107, 0.2)',
                        borderColor: '#ff6b6b',
                        borderWidth: 2,
                        pointRadius: 4,
                        pointBackgroundColor: '#ff6b6b',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Value'
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += formatCurrency(context.parsed.y);
                                    return label;
                                }
                            }
                        },
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        // Update prices with enhanced logic
        async function updatePrices() {
            try {
                const result = await fetchPriceWithRetry();
                const fetchedPrices = result.prices;
                hourlyChanges = result.changes;
                
                // Update API status display
                const apiStatusEl = document.getElementById('apiStatus');
                if (apiStatusEl) {
                    apiStatusEl.textContent = `via ${currentApi}`;
                    apiStatusEl.className = 'api-status ' + (apiStatus === 'live' ? 'live' : apiStatus === 'fallback' ? 'fallback' : 'error');
                }
                
                // Update price values
                Object.keys(fetchedPrices).forEach(symbol => {
                    previousPrices[symbol] = currentPrices[symbol];
                    currentPrices[symbol] = fetchedPrices[symbol];
                });
                
                lastSuccessfulUpdate = Date.now();
                
                // Update displays
                updatePriceDisplay();
                updateTransactionTable();
                updateMobileTransactionList();
                updateDashboard();
            } catch (error) {
                console.error('Error fetching prices:', error.message);
                
                // Update status to error
                const apiStatusEl = document.getElementById('apiStatus');
                if (apiStatusEl) {
                    apiStatusEl.textContent = 'Error';
                    apiStatusEl.className = 'api-status error';
                }
                
                updateTransactionTable();
                updateMobileTransactionList();
                updateDashboard();
            }
        }

        // Update the price display for the selected coin
        function updatePriceDisplay() {
            const priceDisplay = document.getElementById('priceDisplay');
            const priceIndicator = document.getElementById('priceIndicator');
            const hourChangeEl = document.getElementById('hourChange');
            
            if (!priceDisplay || !priceIndicator || !hourChangeEl) return;
            
            if (!selectedCoinForPrice) {
                priceDisplay.textContent = 'Select a coin';
                priceIndicator.textContent = '';
                hourChangeEl.textContent = '';
                return;
            }
            
            const currentPrice = currentPrices[selectedCoinForPrice] || 0;
            const previousPrice = previousPrices[selectedCoinForPrice] || 0;
            
            priceDisplay.textContent = formatCurrency(currentPrice);
            
            if (previousPrice) {
                if (currentPrice > previousPrice) {
                    priceIndicator.textContent = '';
                    priceIndicator.className = 'price-indicator positive';
                } else if (currentPrice < previousPrice) {
                    priceIndicator.textContent = '';
                    priceIndicator.className = 'price-indicator negative';
                } else {
                    priceIndicator.textContent = '';
                    priceIndicator.className = 'price-indicator';
                }
            } else {
                priceIndicator.textContent = '';
            }
            
            // Update 24-hour change display
            if (hourlyChanges[selectedCoinForPrice] !== undefined) {
                const change = hourlyChanges[selectedCoinForPrice];
                hourChangeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}% (24h)`;
                hourChangeEl.className = `hour-change ${change >= 0 ? 'positive' : 'negative'}`;
            } else {
                hourChangeEl.textContent = '';
            }
        }

        // Setup portfolio event listeners
        function setupPortfolioEventListeners() {
            // Tab switching functionality (desktop)
            document.querySelectorAll('.desktop-only .tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });

            // Single transaction form submission
            document.getElementById('transactionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const date = document.getElementById('date').value;
                const coin = document.getElementById('coin').value;
                const type = document.getElementById('type').value;
                const price = parseFloat(document.getElementById('price').value);
                const modalBeli = parseFloat(document.getElementById('modalBeli').value);
                
                if (!coin) {
                    alert('Please select a coin');
                    return;
                }
                
                if (price && modalBeli) {
                    const quantity = modalBeli / price;
                    transactions.push({ date, coin, type, quantity, price, modalBeli });
                    saveTransactions();
                    document.getElementById('transactionForm').reset();
                    updatePrices();
                }
            });

            // Batch transaction form submission
            document.getElementById('batchTransactionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const batchInput = document.getElementById('batchInput').value.trim();
                const batchError = document.getElementById('batchError');
                if (!batchError) return;
                
                batchError.textContent = '';
                
                if (!batchInput) {
                    batchError.textContent = 'Please enter at least one transaction.';
                    return;
                }
                
                const lines = batchInput.split('\n');
                let validTransactions = [];
                let errorMessages = [];
                
                lines.forEach((line, index) => {
                    const parts = line.split(',').map(item => item.trim());
                    if (parts.length !== 5) {
                        errorMessages.push(`Line ${index + 1}: Invalid format. Expected: date,coin,type,price,modalBeli`);
                        return;
                    }
                    
                    const [date, coin, type, priceStr, modalBeliStr] = parts;
                    const price = parseFloat(priceStr);
                    const modalBeli = parseFloat(modalBeliStr);
                    
                    // Validate inputs
                    if (!/^\d{4}-\d{2}-\d{2}/.test(date)) {
                        errorMessages.push(`Line ${index + 1}: Invalid date format. Use YYYY-MM-DD`);
                        return;
                    }
                    
                    if (!['buy', 'sell'].includes(type.toLowerCase())) {
                        errorMessages.push(`Line ${index + 1}: Invalid type. Use 'buy' or 'sell'`);
                        return;
                    }
                    
                    if (isNaN(price) || price <= 0) {
                        errorMessages.push(`Line ${index + 1}: Invalid price. Must be a positive number`);
                        return;
                    }
                    
                    if (isNaN(modalBeli) || modalBeli <= 0) {
                        errorMessages.push(`Line ${index + 1}: Invalid investment. Must be a positive number`);
                        return;
                    }
                    
                    if (!coins.some(c => c.symbol === coin)) {
                        errorMessages.push(`Line ${index + 1}: Invalid coin symbol. Supported coins: ${coins.map(c => c.symbol).join(', ')}`);
                        return;
                    }
                    
                    const quantity = modalBeli / price;
                    validTransactions.push({ date, coin, type: type.toLowerCase(), quantity, price, modalBeli });
                });
                
                if (errorMessages.length > 0) {
                    batchError.innerHTML = errorMessages.join('<br>');
                    return;
                }
                
                transactions.push(...validTransactions);
                saveTransactions();
                document.getElementById('batchTransactionForm').reset();
                updatePrices();
            });

            // Clear all transactions (desktop)
            const clearTransactionsBtn = document.getElementById('clearTransactions');
            if (clearTransactionsBtn) {
                clearTransactionsBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to clear all transactions? This action cannot be undone.')) {
                        transactions = [];
                        localStorage.removeItem('cryptoTransactions');
                        selectedCoin = '';
                        updatePrices();
                    }
                });
            }

            // Clear all transactions (mobile)
            const clearTransactionsMobileBtn = document.getElementById('clearTransactionsMobile');
            if (clearTransactionsMobileBtn) {
                clearTransactionsMobileBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to clear all transactions? This action cannot be undone.')) {
                        transactions = [];
                        localStorage.removeItem('cryptoTransactions');
                        selectedCoin = '';
                        updatePrices();
                    }
                });
            }

            // Chart type switching
            const showValueChartBtn = document.getElementById('showValueChart');
            const showInvestmentChartBtn = document.getElementById('showInvestmentChart');
            const showHoldingsChartBtn = document.getElementById('showHoldingsChart');
            
            if (showValueChartBtn) {
                showValueChartBtn.addEventListener('click', function() {
                    chartType = 'value';
                    updateChartButtons();
                    updateDashboard();
                });
            }
            
            if (showInvestmentChartBtn) {
                showInvestmentChartBtn.addEventListener('click', function() {
                    chartType = 'investment';
                    updateChartButtons();
                    updateDashboard();
                });
            }
            
            if (showHoldingsChartBtn) {
                showHoldingsChartBtn.addEventListener('click', function() {
                    chartType = 'holdings';
                    updateChartButtons();
                    updateDashboard();
                });
            }
            
            function updateChartButtons() {
                document.querySelectorAll('.chart-actions button').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                if (chartType === 'value' && showValueChartBtn) {
                    showValueChartBtn.classList.add('active');
                } else if (chartType === 'investment' && showInvestmentChartBtn) {
                    showInvestmentChartBtn.classList.add('active');
                } else if (showHoldingsChartBtn) {
                    showHoldingsChartBtn.classList.add('active');
                }
            }

            // Currency selector event listener
            const currencySelector = document.getElementById('currencySelector');
            if (currencySelector) {
                currencySelector.addEventListener('change', function() {
                    selectedCurrency = this.value;
                    
                    // Update form labels
                    const priceLabel = document.querySelector('label[for="price"]');
                    if (priceLabel) priceLabel.textContent = `Price (${selectedCurrency})`;
                    
                    const investmentLabel = document.querySelector('label[for="modalBeli"]');
                    if (investmentLabel) investmentLabel.textContent = `Investment (${selectedCurrency})`;
                    
                    // Refetch prices to update with new currency
                    updatePrices();
                });
            }

            // Coin selector for price display
            const priceCoinSelector = document.getElementById('priceCoinSelector');
            if (priceCoinSelector) {
                priceCoinSelector.addEventListener('change', function() {
                    selectedCoinForPrice = this.value;
                    updatePriceDisplay();
                });
            }

            // Set today's date as default in date input
            const dateInput = document.getElementById('date');
            if (dateInput) dateInput.valueAsDate = new Date();
        }

        // Input focus effects for login
        const inputs = document.querySelectorAll('#loginPage input');
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.querySelector('.input-icon').style.transform = 'scale(1.3) rotate(10deg)';
            });
            
            input.addEventListener('blur', function() {
                this.parentElement.querySelector('.input-icon').style.transform = 'scale(1) rotate(0)';
            });
        });

        // Handle window resize for responsive adjustments
        window.addEventListener('resize', function() {
            // Update chart if it exists
            if (performanceChart) {
                performanceChart.resize();
            }
        });
    </script>
</body>
</html>